services:
  - type: web
    name: orchestrator-api
    runtime: node
    plan: free # Nivelado para Tier Gratuito (MVP)

    # üöÄ COMANDO DE √âLITE:
    # Utilizamos el script 'system:hydrate' del package.json para garantizar
    # que los idiomas, la DB y el build de Nx se ejecuten en orden at√≥mico.
    buildCommand: pnpm run system:hydrate && npx nx build orchestrator-api --prod

    # üèÅ PUNTO DE ENTRADA:
    # Apunta al bundle generado por Webpack/Nx.
    startCommand: node dist/apps/orchestrator-api/main.js

    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        sync: false # Cargar manualmente en Render Dashboard
      - key: GOOGLE_GEMINI_API_KEY
        sync: false
      - key: UPSTASH_REDIS_REST_URL
        sync: false
      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false
      - key: QDRANT_URL
        sync: false
      - key: QDRANT_API_KEY
        sync: false
      - key: SKIP_INSTALL_DEPS_CHECK
        value: 'true'
